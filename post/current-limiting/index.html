
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Ghost Stories">
    <title>高并发系统限流设计 - Ghost Stories</title>
    <meta name="author" content="Ghost Stories">
    
    
        <link rel="icon" href="http://wangnan.tech/assets/images/favicon.ico">
    
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="高并发系统限流设计">
<meta property="og:url" content="http://wangnan.tech/post/current-limiting/index.html">
<meta property="og:site_name" content="Ghost Stories">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/79431-500e4398a87b1738.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/79431-d19d892c42a49a52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/485/format/webp">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/79431-03d86f2392f16acd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp">
<meta property="og:updated_time" content="2018-12-17T03:08:36.780Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="高并发系统限流设计">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/79431-500e4398a87b1738.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp">
<meta name="twitter:creator" content="@twitter">
    
        <link rel="publisher" href="https://plus.google.com/google_plus_business"/>
    
    
        
    
    
        <meta property="og:image" content="http://wangnan.tech/assets/images/ice_bear.jpg"/>
    
    
        <meta property="og:image" content="https://upload-images.jianshu.io/upload_images/79431-500e4398a87b1738.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://upload-images.jianshu.io/upload_images/79431-500e4398a87b1738.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-sxklfps8ywgfyyjcowvnb4gxdgt0zjts3hsguljmv9uqanxjbnitrovtbrek.min.css">
    <!--STYLES END-->
    
    
    <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0df8e38c5e76634531942b2634b055eb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Ghost Stories</a>
    </div>
    
        
            <a  class="header-right-icon st-search-show-outputs"
                href="/about">
        
        
            <i class="fa fa-lg fa-favicon.ico"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/ice_bear.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Ghost Stories</h4>
                
                    <h5 class="sidebar-profile-bio"><p>2gether thru life</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://upload-images.jianshu.io/upload_images/79431-35dc28cc6de6e839.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/258/format/webp" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-external-link"></i>
                        <span class="sidebar-button-desc">Wechat</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://www.jianshu.com/u/244399b1d776" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-external-link"></i>
                        <span class="sidebar-button-desc">JianShu</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://zhuanlan.zhihu.com/ghoststories" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-external-link"></i>
                        <span class="sidebar-button-desc">ZhiHu</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://blog.csdn.net/wangnan9279" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-external-link"></i>
                        <span class="sidebar-button-desc">CSDN</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            高并发系统限流设计
        </h1>
    
    
        <div class="post-meta">
    <time itemprop="datePublished" datetime="2017-10-25T10:07:58+08:00">
	
		    Oct 25, 2017
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/架构/">架构</a>


    
</div>

    
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p><span><br><a id="more"></a><br><img src="https://upload-images.jianshu.io/upload_images/79431-500e4398a87b1738.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp" alt=""><br><h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#限流方式"><span class="toc-text">限流方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#限流算法"><span class="toc-text">限流算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#令牌桶"><span class="toc-text">令牌桶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏桶"><span class="toc-text">漏桶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#计数器"><span class="toc-text">计数器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#令牌桶vs漏桶"><span class="toc-text">令牌桶vs漏桶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#应用级别限流"><span class="toc-text">应用级别限流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#限流总并发-连接-请求数"><span class="toc-text">限流总并发/连接/请求数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限流总资源数"><span class="toc-text">限流总资源数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限流某个接口的总并发-请求数"><span class="toc-text">限流某个接口的总并发/请求数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限流某个接口的时间窗请求数"><span class="toc-text">限流某个接口的时间窗请求数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#平滑限流某个接口的请求数"><span class="toc-text">平滑限流某个接口的请求数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式限流"><span class="toc-text">分布式限流</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#接入层限流"><span class="toc-text">接入层限流</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考自文章"><span class="toc-text">参考自文章</span></a></li></ol></span></p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>高并发系统时有三把利器用来保护系统：缓存、降级和限流，缓存的目的是提升系统访问速度和增大系统能处理的容量，降级是当服务出问题或者影响到核心流程的性能则需要暂时屏蔽掉，待高峰或者问题解决后再打开，而有些场景并不能用缓存和降级来解决，比如稀缺资源（秒杀、抢购）、写服务（如评论、下单）、频繁的复杂查询（评论的最后几页），因此需有一种手段来限制这些场景的并发/请求量，即限流</p>
<p>限流的目的是通过对并发访问/请求进行限速或者一个时间窗口内的的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务（定向到错误页或告知资源没有了）、排队或等待（比如秒杀、评论、下单）、降级（返回托底数据或默认数据，如商品详情页库存默认有货）。</p>
<h2 id="限流方式"><a href="#限流方式" class="headerlink" title="限流方式"></a>限流方式</h2><ul>
<li>限制总并发数（比如数据库连接池、线程池）</li>
<li>限制瞬时并发数（如nginx的limit_conn模块，用来限制瞬时并发连接数）</li>
<li>限制时间窗口内的平均速率（如Guava的RateLimiter、nginx的limit_req模块，限制每秒的平均速率）</li>
<li>限制远程接口调用速率</li>
<li>限制MQ的消费速率。</li>
<li>可以根据网络连接数、网络流量、CPU或内存负载等来限流</li>
</ul>
<h1 id="限流算法"><a href="#限流算法" class="headerlink" title="限流算法"></a>限流算法</h1><h2 id="令牌桶"><a href="#令牌桶" class="headerlink" title="令牌桶"></a>令牌桶</h2><p><img src="https://upload-images.jianshu.io/upload_images/79431-d19d892c42a49a52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/485/format/webp" alt=""></p>
<h2 id="漏桶"><a href="#漏桶" class="headerlink" title="漏桶"></a>漏桶</h2><p><img src="https://upload-images.jianshu.io/upload_images/79431-03d86f2392f16acd.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp" alt=""></p>
<h2 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h2><p>有时候我们还使用计数器来进行限流，主要用来限制总并发数，比如数据库连接池、线程池、秒杀的并发数；只要全局总请求数或者一定时间段的总请求数设定的阀值则进行限流，是简单粗暴的总数量限流，而不是平均速率限流</p>
<h2 id="令牌桶vs漏桶"><a href="#令牌桶vs漏桶" class="headerlink" title="令牌桶vs漏桶"></a>令牌桶vs漏桶</h2><p>令牌桶限制的是平均流入速率，允许突发请求，并允许一定程度突发流量<br>漏桶限制的是常量流出速率，从而平滑突发流入速率</p>
<h1 id="应用级别限流"><a href="#应用级别限流" class="headerlink" title="应用级别限流"></a>应用级别限流</h1><h2 id="限流总并发-连接-请求数"><a href="#限流总并发-连接-请求数" class="headerlink" title="限流总并发/连接/请求数"></a>限流总并发/连接/请求数</h2><p>如果你使用过Tomcat，其Connector其中一种配置有如下几个参数:</p>
<ul>
<li>acceptCount:如果Tomcat的线程都忙于响应，新来的连接会进入队列排队，如果超出排队大小，则拒绝连接</li>
<li>maxConnections:瞬时最大连接数，超出的会排队等待</li>
<li>maxThreads:Tomcat能启动用来处理请求的最大线程数，如果请求处理量一直远远大于最大线程数则可能会僵死</li>
</ul>
<h2 id="限流总资源数"><a href="#限流总资源数" class="headerlink" title="限流总资源数"></a>限流总资源数</h2><p>可以使用池化技术来限制总资源数：连接池、线程池。比如分配给每个应用的数据库连接是100，那么本应用最多可以使用100个资源，超出了可以等待或者抛异常</p>
<h2 id="限流某个接口的总并发-请求数"><a href="#限流某个接口的总并发-请求数" class="headerlink" title="限流某个接口的总并发/请求数"></a>限流某个接口的总并发/请求数</h2><p>可以使用Java中的AtomicLong，示意代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>&#123;</div><div class="line"><span class="keyword">if</span>(atomic.incrementAndGet() &gt; 限流数) &#123;</div><div class="line"><span class="comment">//拒绝请求</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//处理请求</span></div><div class="line">&#125;<span class="keyword">finally</span>&#123;</div><div class="line">atomic.decrementAndGet();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="限流某个接口的时间窗请求数"><a href="#限流某个接口的时间窗请求数" class="headerlink" title="限流某个接口的时间窗请求数"></a>限流某个接口的时间窗请求数</h2><p>使用Guava的Cache,示意代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">LoadingCache counter =</div><div class="line">CacheBuilder.newBuilder()</div><div class="line">.expireAfterWrite(<span class="number">2</span>, TimeUnit.SECONDS)</div><div class="line">.build(newCacheLoader() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function">publicAtomicLong <span class="title">load</span><span class="params">(Long seconds)</span>throwsException </span>&#123;</div><div class="line"><span class="keyword">return</span> newAtomicLong(<span class="number">0</span>);</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">longlimit =<span class="number">1000</span>;</div><div class="line"><span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</div><div class="line"><span class="comment">//得到当前秒longcurrentSeconds = System.currentTimeMillis() /1000;</span></div><div class="line"><span class="keyword">if</span>(counter.get(currentSeconds).incrementAndGet() &gt; limit) &#123;</div><div class="line">System.out.println(<span class="string">"限流了:"</span>+ currentSeconds);</div><div class="line"><span class="keyword">continue</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">//业务处理</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="平滑限流某个接口的请求数"><a href="#平滑限流某个接口的请求数" class="headerlink" title="平滑限流某个接口的请求数"></a>平滑限流某个接口的请求数</h2><p>之前的限流方式都不能很好地应对突发请求，即瞬间请求可能都被允许从而导致一些问题；因此在一些场景中需要对突发请求进行整形，整形为平均速率请求处理</p>
<p>Guava框架提供了令牌桶算法实现</p>
<p>Guava RateLimiter提供了令牌桶算法实现：平滑突发限流(SmoothBursty)和平滑预热限流(SmoothWarmingUp)实现</p>
<p><strong>平滑突发限流(SmoothBursty)</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">RateLimiter limiter = RateLimiter.create(<span class="number">5</span>);</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">将得到类似如下的输出：</div><div class="line"><span class="number">0.0</span></div><div class="line"><span class="number">0.198239</span></div><div class="line"><span class="number">0.196083</span></div><div class="line"><span class="number">0.200609</span></div><div class="line"><span class="number">0.199599</span></div><div class="line"><span class="number">0.19961</span></div></pre></td></tr></table></figure></p>
<p>limiter.acquire(5)表示桶的容量为5且每秒新增5个令牌</p>
<p><strong>平滑预热限流(SmoothWarmingUp)</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">RateLimiter limiter = RateLimiter.create(<span class="number">5</span>,<span class="number">1000</span>, TimeUnit.MILLISECONDS);</div><div class="line"><span class="keyword">for</span>(inti =<span class="number">1</span>; i &lt;<span class="number">5</span>;i++) &#123;</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">&#125;</div><div class="line">Thread.sleep(<span class="number">1000L</span>);</div><div class="line"><span class="keyword">for</span>(inti =<span class="number">1</span>; i &lt;<span class="number">5</span>;i++) &#123;</div><div class="line">System.out.println(limiter.acquire());</div><div class="line">&#125;</div><div class="line">将得到类似如下的输出：</div><div class="line"><span class="number">0.0</span></div><div class="line"><span class="number">0.51767</span></div><div class="line"><span class="number">0.357814</span></div><div class="line"><span class="number">0.219992</span></div><div class="line"><span class="number">0.199984</span></div><div class="line"><span class="number">0.0</span></div><div class="line"><span class="number">0.360826</span></div><div class="line"><span class="number">0.220166</span></div><div class="line"><span class="number">0.199723</span></div><div class="line"><span class="number">0.199555</span></div></pre></td></tr></table></figure></p>
<p>SmoothWarmingUp创建方式：RateLimiter.create(doublepermitsPerSecond, long warmupPeriod, TimeUnit unit)<br>permitsPerSecond表示每秒新增的令牌数，warmupPeriod表示在从冷启动速率过渡到平均速率的时间间隔。</p>
<p>速率是梯形上升速率的，也就是说冷启动时会以一个比较大的速率慢慢到平均速率；然后趋于平均速率（梯形下降到平均速率）。可以通过调节warmupPeriod参数实现一开始就是平滑固定速率。</p>
<h1 id="分布式限流"><a href="#分布式限流" class="headerlink" title="分布式限流"></a>分布式限流</h1><p>分布式限流最关键的是要将限流服务做成原子化,而解决方案可以使使用redis+lua或者nginx+lua技术进行实现</p>
<p>详见参考文章</p>
<h1 id="接入层限流"><a href="#接入层限流" class="headerlink" title="接入层限流"></a>接入层限流</h1><p>接入层通常指请求流量的入口，该层的主要目的有：负载均衡、非法请求过滤、请求聚合、缓存、降级、限流、A/B测试、服务质量监控等等</p>
<p>对于Nginx接入层限流可以使用Nginx自带了两个模块：连接数限流模块ngx_http_limit_conn_module和漏桶算法实现的请求限流模块ngx_http_limit_req_module。还可以使用OpenResty提供的Lua限流模块lua-resty-limit-traffic进行更复杂的限流场景。</p>
<p>limit_conn用来对某个KEY对应的总的网络连接数进行限流，可以按照如IP、域名维度进行限流。</p>
<p>limit_req用来对某个KEY对应的请求的平均速率进行限流，并有两种用法：平滑模式（delay）和允许突发模式(nodelay)。</p>
<p>OpenResty提供的Lua限流模块lua-resty-limit-traffic进行更复杂的限流场景</p>
<p>详见参考文章</p>
<p>（本文完）</p>
<h1 id="参考自文章"><a href="#参考自文章" class="headerlink" title="参考自文章"></a>参考自文章</h1><ul>
<li><a href="http://www.jianshu.com/p/0d7ca597ebd2" target="_blank" rel="external">http://www.jianshu.com/p/0d7ca597ebd2</a></li>
<li><a href="http://www.jianshu.com/p/b7945524a37b" target="_blank" rel="external">http://www.jianshu.com/p/b7945524a37b</a></li>
<li><a href="http://www.54tianzhisheng.cn/2017/09/23/Guava-limit/" target="_blank" rel="external">http://www.54tianzhisheng.cn/2017/09/23/Guava-limit/</a></li>
</ul>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/post/logstash-note/"  data-tooltip="Logstash学习笔记">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/post/git-rebase/" data-tooltip="Git rebase详细解析">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Ghost Stories. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/post/logstash-note/"  data-tooltip="Logstash学习笔记">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/post/git-rebase/" data-tooltip="Git rebase详细解析">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-facebook-official"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-google-plus"></i>
                </a>
            </li>
        
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="5">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-twitter"></i><span>Share on Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://wangnan.tech/post/current-limiting/">
                    <i class="fa fa-google-plus"></i><span>Share on Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/ice_bear.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Ghost Stories</h4>
        
            <div id="about-card-bio"><p>2gether thru life</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Backend Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Nanjing,China
            </div>
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/elasticsearch-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-c6d398af52f4b48c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/558/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/elasticsearch-introduction/">
                            <h3 class="media-heading">Elasticsearch简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 8, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/mybatis-getting-started/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-74576230a7ae676d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/414/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/mybatis-getting-started/">
                            <h3 class="media-heading">Java项目中使用Mybatis入门程序</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 18, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/tool-swagger-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-1eeb83c0143434ef.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/475/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/tool-swagger-introduction/">
                            <h3 class="media-heading">Swagger简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/tool-Sublime-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-e6a274bd932cc627.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/509/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/tool-Sublime-introduction/">
                            <h3 class="media-heading">Sublime Text 3简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    May 28, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-reflection-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-ecfaca092a4a12a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-reflection-introduction/">
                            <h3 class="media-heading">Java反射简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 8, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/redis-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-62f90e62a67ab070.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/244/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/redis-introduction/">
                            <h3 class="media-heading">Redis初识</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 13, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-proxy-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-9973d5493466523a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/510/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-proxy-introduction/">
                            <h3 class="media-heading">Java代理简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 13, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-annotation-introduction/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-ecfaca092a4a12a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-annotation-introduction/">
                            <h3 class="media-heading">Java注解简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 18, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-ThreadLocal/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-ecfaca092a4a12a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/java-ThreadLocal/">
                            <h3 class="media-heading">Java ThreadLocal 简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 23, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://wangnan.tech/post/read-youth/">
                            <img class="media-image" src="https://upload-images.jianshu.io/upload_images/79431-04062861cf5e850f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/510/format/webp" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://wangnan.tech/post/read-youth/">
                            <h3 class="media-heading">《年轻可以一无所有》书摘</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 28, 2016
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><!-- toc --></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                118 posts found
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-ivwiy10zeb8fifc4swnhkwneuk64y53w2scmdmtp8thi9cqfxh31aowtroaz.min.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'http://wangnan.tech/post/current-limiting/';
                 
                    this.page.identifier = 'post/current-limiting/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'wangnan9279';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    


    </body>
</html>
